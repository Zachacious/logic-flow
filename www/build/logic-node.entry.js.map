{"file":"logic-node.entry.esm.js","mappings":"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","names":[],"sources":["src/components/logic-node/logic-node.css?tag=logic-node","src/components/logic-node/logic-node.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n","import { Component, Host, Prop, h, Element, State, Watch } from '@stencil/core';\nimport { Point } from '../../types/Point';\nimport { throttle } from '../../utils/throttle';\nimport { getEventLocation } from '../../utils/getEventLocation';\nimport { debounce } from '../../utils/debounce';\n// import { events } from '../../events';\n\n@Component({\n  tag: 'logic-node',\n  styleUrl: 'logic-node.css',\n  shadow: false,\n})\nexport class LogicNode {\n  @Element() el: HTMLElement;\n\n  @Prop() type: string = 'default';\n  @Prop() title: string = 'Node';\n  @Prop({ mutable: true }) position: Point = { x: 0, y: 0 };\n\n  @State() isDragging = false;\n\n  private _canvasZoom = 1;\n  private _canvasPan = { x: 0, y: 0 };\n\n  private _dragStart: Point = { x: 0, y: 0 };\n\n  private _throttledPointerMove = throttle(e => this.onPointerMove(e), 10);\n  private _throttledTouchMove = throttle(e => this.handleTouchMove(e), 10);\n\n  private _elMouseDown = (e: MouseEvent | TouchEvent) => this.onPointerDown(e);\n  private _elMouseUp = () => this.onPointerUp();\n  private _elMouseMove = (e: MouseEvent | TouchEvent) =>\n    this._throttledPointerMove(e);\n\n  private _elTouchStart = (e: TouchEvent) => this.handleTouchStart(e);\n  private _elTouchMove = (e: TouchEvent) => this._throttledTouchMove(e);\n  private _elTouchEnd = () => this.onPointerUp();\n\n  private _debouncedUpdateTransform = debounce(\n    () => this.updateTransform(),\n    10,\n  );\n\n  componentDidLoad() {\n    window.addEventListener('mouseup', this._elMouseUp, { passive: true });\n    window.addEventListener('mousemove', this._elMouseMove, { passive: false });\n\n    this.el.addEventListener('mousedown', this._elMouseDown, {\n      passive: false,\n    });\n    this.el.addEventListener('touchstart', this._elTouchStart, {\n      passive: false,\n    });\n    this.el.addEventListener('touchend', this._elTouchEnd, { passive: true });\n    this.el.addEventListener('touchmove', this._elTouchMove, {\n      passive: false,\n    });\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener('mouseup', this._elMouseUp);\n    window.removeEventListener('mousemove', this._elMouseMove);\n\n    this.el.removeEventListener('mousedown', this._elMouseDown);\n    this.el.removeEventListener('touchstart', this._elTouchStart);\n    this.el.removeEventListener('touchend', this._elTouchEnd);\n    this.el.removeEventListener('touchmove', this._elTouchMove);\n  }\n\n  @Watch('position')\n  onPositionChange() {\n    // update transform\n    this._debouncedUpdateTransform();\n    // this.el.style.transform = `translate(${this.position.x}px, ${this.position.y}px)`;\n  }\n\n  updateTransform() {\n    this.el.style.transform = `translate(${this.position.x}px, ${this.position.y}px )`;\n  }\n\n  // handle drag and drop positioning\n  onPointerDown(e: MouseEvent | TouchEvent) {\n    e.stopPropagation();\n    this.isDragging = true;\n\n    const loc = getEventLocation(e);\n    // Get the current position of the node\n    const nodeRect = this.el.getBoundingClientRect();\n\n    // Get canvas bounding rect for pan/zoom calculations\n    const contentEl = this.el.closest('.flowy-content') as HTMLElement;\n    if (!contentEl) return;\n\n    // Store the current canvas zoom level\n    const zoomMatches = contentEl.style.transform.match(\n      /scale\\((\\d+(?:\\.\\d+)?)\\)/,\n    );\n    this._canvasZoom = zoomMatches ? parseFloat(zoomMatches[1]) : 1;\n\n    // Store the current canvas pan position\n    const panMatches = contentEl.style.transform.match(\n      /translate\\((-?\\d+(?:\\.\\d*)?)px, (-?\\d+(?:\\.\\d*)?)px\\)/,\n    );\n\n    this._canvasPan = {\n      x: panMatches ? parseInt(panMatches[1], 10) : 0,\n      y: panMatches ? parseInt(panMatches[2], 10) : 0,\n    };\n\n    this._dragStart = {\n      x: (loc.x - nodeRect.left) / this._canvasZoom,\n      y: (loc.y - nodeRect.top) / this._canvasZoom,\n    };\n  }\n\n  onPointerMove(e: MouseEvent | TouchEvent) {\n    if (!this.isDragging) return;\n    e.stopPropagation();\n\n    requestAnimationFrame(() => {\n      const loc = getEventLocation(e);\n      const newX =\n        loc.x / this._canvasZoom - this._dragStart.x - this._canvasPan.x;\n      const newY =\n        loc.y / this._canvasZoom - this._dragStart.y - this._canvasPan.y;\n\n      this.position = { x: newX, y: newY };\n    });\n  }\n\n  onPointerUp() {\n    this.isDragging = false;\n  }\n\n  handleTouchStart(e: TouchEvent) {\n    e.preventDefault();\n    this.onPointerDown(e);\n  }\n\n  handleTouchMove(e: TouchEvent) {\n    e.preventDefault();\n    this.onPointerMove(e);\n  }\n\n  render() {\n    return (\n      <Host class=\"flowy-node\">\n        {/* <div class=\"flowy-node\"> */}\n        <div class=\"flowy-node-header\">\n          {this.title}\n          <slot name=\"header\"></slot>\n        </div>\n        <slot></slot>\n        <div class=\"flowy-node-footer\"></div>\n        {/* </div> */}\n      </Host>\n    );\n  }\n}\n"],"version":3}